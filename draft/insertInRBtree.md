---
title: 学习笔记之红黑树插入
categories: [Java, Data Structure]
toc: true 
---
# 学习笔记之红黑树插入

### 关于红黑树
红黑树本质上还是一颗二叉搜索树，与普通的二叉搜索树不一样的地方，是红黑树的节点赋予了红黑的颜色属性，用于在树的结构改变时调整树的失衡。

普通的二叉搜索树在插入和删除时没有树结构的调整，尽管平均树高度为lg(n)，平均复杂度为O(lg(n))，但是高度取决于插入的数据顺序，不稳定；极端情况下，当数据以顺序或者倒序插入时，树结构就退化成了链表，复杂度退化成O(n)。

### 红黑树性质
红黑树的定义有如下五条性质：

* 树节点有颜色属性，不是红色就是黑色
* 根节点是黑色的
* 叶子节点是空节点，颜色是黑色的
* 没有连续的红节点
* 从根节点开始，到叶子节点的所有路径中，包含的黑色节点个数（黑高）相等

由4和5两条性质可以推断出，从根节点到叶子节点的所有路径中，最长路径节点数最多是最短路径的2倍；最短路径为全黑节点构成的路径，最长路径为红黑节点交替构成的路径。因此红黑树的高度能够始终控制在2lg(n)数量级内，所有操作复杂度均为O(lg(n))。

例如：
![example](./pic/rbtree/p1.png)
例子列出了黑高为2的红黑树的所有路径情况，各个路径节点数分别为4，3，3，2。

### 牢记
红黑树在插入节点和删除节点之前，必定是满足红黑性质的！时刻牢记两个性质：

1. 没有连续的红节点
2. 黑高相等。

### 红黑树插入
红黑树插入节点的操作与普通二叉搜索树的插入操作一致，与普通搜索树不用的是，插入时可能会破坏红黑树的性质，这时就需要通过调整来恢复。

红黑树将插入的节点设置为红色，可以思考下红黑树哪些性质可能会被破坏？

*  因为插入的节点是红色的，不可能对路径的黑高产生影响，因此性质五不会被破坏。
*  因为插入的节点是红色的，其父节点可能为红色，可能会产生连续的红节点，因此性质四可能会被破坏，这时候就需要判断调整结构。

以当前节点x是其父节点xp的左子节点为例（右子节点为对称情况），插入需要调整的情况有三种。

* 情况1： 当前节点x为红色，父节点xp为红色，父节点xp为祖父节点xgp的左子节点，并且父节点的兄弟节点xu为红色（图中Ax表示A子树的高黑为x）：
![insert1](./pic/rbtree/insert1.png)
调整操作将xp，xu设置为黑色，将根节点xgp设置为红色，然后将根节点xgp设置为新的x。

对与此子树，通过调整满足了红黑性质，调整前的黑高为x+1，调整后的黑高为x+1，因此对于上层而言，子树的黑高是没有变化的（性质五不会被破坏），唯一的变化是根节点的颜色由黑色变为红色，因此将x设置为根节点，当上层节点为红色时，可继续向上循环判断。

* 情况2： 当前节点x为红色，父节点xp为红色，父节点xp为祖父节点xgp的左子节点，并且父节点的兄弟节点xu为黑色
![insert2](./pic/rbtree/insert2.png)
调整操作将xp设置为黑色，xgp设置为红色，然后将xgp右旋，将xp设置为新的x。

对与此子树，通过调整满足了红黑性质，调整前的黑高为x+1，调整后的黑高为x+1，同时对于上层来说根节点的颜色均为黑色，此情况的红黑树形状恢复完毕，将x设置为黑色的xp节点，跳出循环条件。

* 情况3： 当前节点x为红色，父节点xp为红色，父节点xp为祖父节点xgp的右子节点
![insert3](./pic/rbtree/insert3.png)
调整操作将xp右旋，将xp设置为新的x。

此操作可将情况3转化为情况1或者情况2（上述情况的对称情况），然后设置新的x循环判断调整。

因此，x满足以下条件可终止循环（插入调整完毕）：

* x为黑节点（情况2）
* x为根节点（情况1）
* x的父节点为根节点（情况1）
